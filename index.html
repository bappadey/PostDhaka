<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Dhaka | Visual Experience</title>
    <link rel="icon" href="Assets/Post Dhaka icon.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* CSS SAME AS BEFORE */
        :root { --primary-blue: #0872B9; --primary-pink: #EA1C5C; --bg-dark: #121A2D; --white: #FFFFFF; --gray: #B0B0B0; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Helvetica Neue', Arial, sans-serif; }
        body { background-color: var(--bg-dark); color: var(--white); overflow-x: hidden; }
        
        /* Intro & Nav CSS (No Change) */
        #intro-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: var(--bg-dark); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 0.8s; }
        #intro-overlay video { width: 100%; height: 100%; object-fit: cover; }
        .skip-btn { position: absolute; bottom: 30px; padding: 10px 25px; background: rgba(255,255,255,0.1); border: 1px solid var(--primary-pink); color: var(--white); cursor: pointer; border-radius: 30px; z-index: 10000; }
        #intro-overlay.hidden { transform: translateY(-100%); }
        
        nav { position: fixed; top: 0; width: 100%; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; background: rgba(18, 26, 45, 0.95); backdrop-filter: blur(10px); z-index: 1000; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .logo img { height: 40px; width: auto; cursor: pointer;}
        .menu a { color: var(--white); text-decoration: none; margin-left: 35px; font-size: 14px; font-weight: 600; text-transform: uppercase; transition: color 0.3s; cursor: pointer; }
        .menu a.active { color: var(--primary-pink); }
        
        section { display: none; padding: 100px 20px 50px 20px; min-height: 100vh; animation: fadeIn 0.5s; }
        section.active-section { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* GRID CSS (No Change) */
        .video-grid { display: grid; grid-template-columns: repeat(4, 1fr); grid-auto-rows: 200px; gap: 15px; max-width: 1800px; margin: 0 auto; grid-auto-flow: dense; }
        .video-item { position: relative; background: #000; cursor: pointer; overflow: hidden; border-radius: 4px; transition: 0.3s; }
        .video-item:hover { transform: scale(1.02); z-index: 10; border: 3px solid #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }
        .small { grid-column: span 1; grid-row: span 1; } 
        .medium { grid-column: span 2; grid-row: span 2; } 
        .sq { grid-column: span 1; grid-row: span 2; } 
        .wide { grid-column: span 3; grid-row: span 1; } 
        .semiwide { grid-column: span 2; grid-row: span 1; } 
        .tall { grid-column: span 1; grid-row: span 3; } 
        .semitall { grid-column: span 1; grid-row: span 2; } 
        .large { grid-column: span 3; grid-row: span 2; } 
        .iframe-wrapper { width: 100%; height: 100%; pointer-events: none; position: relative; overflow: hidden; }
        .thumb-img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; transition: opacity 0.3s; }
        .iframe-wrapper iframe { position: absolute; top: 50%; left: 50%; width: 300%; height: 300%; transform: translate(-50%, -50%); opacity: 0; transition: opacity 0.5s; }
        .video-item:hover .iframe-wrapper iframe { opacity: 1; }
        .video-item:hover .thumb-img { opacity: 0; }

        /* SERVICE CSS (Dynamic) */
        .service-container { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; max-width: 1400px; margin: 50px auto; }
        .service-card { background: rgba(255,255,255,0.05); border-radius: 10px; width: 350px; overflow: hidden; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); }
        .service-card:hover { transform: translateY(-10px); border-color: var(--primary-pink); }
        .service-media { height: 200px; background: #000; position: relative; overflow: hidden; }
        .service-media video, .service-media img { width: 100%; height: 100%; object-fit: cover; }
        .service-info { padding: 30px; text-align: center; }
        .service-info h2 { color: var(--primary-blue); margin-bottom: 15px; font-size: 24px; }
        .service-info p { color: var(--gray); line-height: 1.6; font-size: 14px; }

        /* ABOUT CSS */
        .about-container { max-width: 900px; margin: 50px auto; text-align: center; }
        .about-container h1 { font-size: 48px; color: var(--primary-pink); margin-bottom: 30px; }
        .about-container p { font-size: 18px; line-height: 1.8; color: #ddd; margin-bottom: 20px; text-align: justify; white-space: pre-wrap; }

        /* CONTACT CSS */
        .contact-wrapper { display: flex; flex-wrap: wrap; justify-content: center; gap: 50px; max-width: 1200px; margin: 50px auto; }
        .contact-info { flex: 1; min-width: 300px; }
        .contact-item { display: flex; align-items: center; margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 8px; }
        .contact-icon { font-size: 24px; color: var(--primary-pink); margin-right: 20px; width: 40px; text-align: center;}
        .contact-text h3 { color: var(--white); font-size: 18px; margin-bottom: 5px; }
        .contact-text p, .contact-text a { color: var(--gray); font-size: 14px; text-decoration: none; }
        .map-container { flex: 1; min-width: 300px; height: 400px; border-radius: 10px; overflow: hidden; border: 2px solid #333; }
        .map-container iframe { width: 100%; height: 100%; border: 0; filter: invert(90%) hue-rotate(180deg); }

        /* MODAL */
        #video-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(18, 26, 45, 0.98); z-index: 5000; display: none; justify-content: center; align-items: center; }
        #video-modal.active { display: flex; }
        .modal-content { width: 90%; max-width: 1200px; aspect-ratio: 16/9; position: relative; background: #000; box-shadow: 0 0 30px var(--primary-blue); }
        .close-btn { position: absolute; top: -50px; right: 0; color: #fff; font-size: 40px; cursor: pointer; }
        
        @media (max-width: 768px) { .video-grid { grid-template-columns: repeat(2, 1fr); } .wide, .large { grid-column: span 2; grid-row: span 1; } .tall { grid-row: span 2; } }
    </style>
</head>
<body>

    <!-- INTRO -->
    <div id="intro-overlay">
        <video id="introVideo" autoplay muted playsinline>
            <source src="Assets/Logo Intro.webm" type="video/webm">
            <source src="Assets/Logo Intro.mp4" type="video/mp4">
        </video>
        <button class="skip-btn" onclick="enterSite()">SKIP INTRO</button>
    </div>

    <!-- NAVIGATION -->
    <nav>
        <div class="logo" onclick="showSection('home')">
            <img src="Assets/Post Dhaka Logo.png" alt="Post Dhaka">
        </div>
        <div class="menu">
            <a href="#" onclick="showSection('home')" class="active">HOME</a>
            <a href="#" onclick="showSection('service')">SERVICE</a>
            <a href="#" onclick="showSection('about')">ABOUT</a>
            <a href="#" onclick="showSection('contact')">CONTACT</a>
        </div>
    </nav>

    <!-- HOME (Grid) -->
    <section id="home" class="active-section">
        <div class="video-grid" id="gallery-container">
            <p style="text-align:center; width:100%; color:gray;">Loading Portfolio...</p>
        </div>
    </section>

    <!-- SERVICE -->
    <section id="service">
        <div style="text-align:center; margin-bottom:40px;">
            <h1 style="font-size:40px; color:white;">OUR SERVICES</h1>
            <div style="height:3px; width:60px; background:var(--primary-pink); margin:10px auto;"></div>
        </div>
        <div class="service-container" id="dynamic-services">
            <!-- Services will be injected here by Firebase -->
        </div>
    </section>

    <!-- ABOUT -->
    <section id="about">
        <div class="about-container">
            <h1 id="about-title">WHO WE ARE</h1>
            <div id="about-desc">Loading...</div>
        </div>
    </section>

    <!-- CONTACT -->
    <section id="contact">
        <div style="text-align:center; margin-bottom:50px;">
            <h1 style="font-size:40px; color:white;">GET IN TOUCH</h1>
        </div>
        <div class="contact-wrapper">
            <div class="contact-info">
                <div class="contact-item">
                    <div class="contact-icon"><i class="fas fa-phone-alt"></i></div>
                    <div class="contact-text">
                        <h3>Phone</h3>
                        <p><a href="#" id="contact-phone">...</a></p>
                    </div>
                </div>
                <div class="contact-item">
                    <div class="contact-icon"><i class="fas fa-envelope"></i></div>
                    <div class="contact-text">
                        <h3>Email</h3>
                        <p><a href="#" id="contact-email">...</a></p>
                    </div>
                </div>
                <div class="contact-item">
                    <div class="contact-icon"><i class="fab fa-facebook-f"></i></div>
                    <div class="contact-text">
                        <h3>Facebook</h3>
                        <p><a href="#" id="contact-fb" target="_blank">...</a></p>
                    </div>
                </div>
                <div class="contact-item">
                    <div class="contact-icon"><i class="fas fa-map-marker-alt"></i></div>
                    <div class="contact-text">
                        <h3>Studio Address</h3>
                        <p id="contact-addr">...</p>
                    </div>
                </div>
            </div>
            <div class="map-container">
                <iframe src="https://maps.google.com/maps?q=23.7732081,90.4074902&hl=en&z=17&output=embed" allowfullscreen="" loading="lazy"></iframe>
            </div>
        </div>
    </section>

    <!-- MODAL -->
    <div id="video-modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div id="youtube-player-container" style="width:100%; height:100%;"></div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, getDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBzQ81jG6k6ieD5HShAgubU3fX0eV6x7j8",
            authDomain: "postdhaka-links.firebaseapp.com",
            projectId: "postdhaka-links",
            storageBucket: "postdhaka-links.firebasestorage.app",
            messagingSenderId: "21578530372",
            appId: "1:21578530372:web:ce243a7141d402fb924611",
            measurementId: "G-EZVZ5DSX46"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 1. LOAD VIDEOS
        async function loadVideos() {
            const container = document.getElementById('gallery-container');
            try {
                const q = query(collection(db, "videos"), orderBy("orderIndex", "asc"));
                const snap = await getDocs(q);
                let html = '';
                snap.forEach((doc, idx) => {
                    const d = doc.data();
                    const url = `https://www.youtube.com/embed/${d.id}?enablejsapi=1&autoplay=1&mute=1&controls=0&showinfo=0&rel=0&loop=1&playlist=${d.id}&modestbranding=1`;
                    html += `
                    <div class="video-item ${d.cls}" onclick="openModal('${d.id}')">
                        <div class="hover-overlay"></div>
                        <div class="iframe-wrapper">
                            <img class="thumb-img" src="https://img.youtube.com/vi/${d.id}/maxresdefault.jpg">
                            <iframe src="${url}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                        </div>
                    </div>`;
                });
                if(html) container.innerHTML = html;
                else container.innerHTML = "<p>No videos found.</p>";
            } catch (e) { console.log(e); }
        }

        // 2. LOAD SERVICES
        async function loadServices() {
            const container = document.getElementById('dynamic-services');
            try {
                const q = query(collection(db, "content_services"), orderBy("order", "asc"));
                const snap = await getDocs(q);
                if(!snap.empty) {
                    let html = '';
                    snap.forEach(doc => {
                        const s = doc.data();
                        let mediaHtml = '';
                        // Determine if video or image
                        if(s.type === 'video') {
                            mediaHtml = `<video autoplay muted loop playsinline poster="${s.src}"><source src="${s.src}"></video>`;
                        } else {
                            mediaHtml = `<img src="${s.src}" alt="${s.title}">`;
                        }

                        html += `
                        <div class="service-card">
                            <div class="service-media">${mediaHtml}</div>
                            <div class="service-info">
                                <h2>${s.title}</h2>
                                <p>${s.description}</p>
                            </div>
                        </div>`;
                    });
                    container.innerHTML = html;
                } else {
                    // Fallback to static if no DB data
                    // (Keeping structure but empty to force user to use admin)
                    container.innerHTML = "<p style='color:gray'>Services loading or not set in Admin.</p>";
                }
            } catch(e) { console.log(e); }
        }

        // 3. LOAD ABOUT
        async function loadAbout() {
            try {
                const docSnap = await getDoc(doc(db, "site_content", "about"));
                if (docSnap.exists()) {
                    const d = docSnap.data();
                    document.getElementById('about-title').innerText = d.title || "WHO WE ARE";
                    document.getElementById('about-desc').innerText = d.description || "";
                } else {
                    // Fallback text
                    document.getElementById('about-desc').innerHTML = `<p><span class="highlight-text">Post Dhaka</span> is a creative post-production...</p>`;
                }
            } catch(e) {}
        }

        // 4. LOAD CONTACT
        async function loadContact() {
            try {
                const docSnap = await getDoc(doc(db, "site_content", "contact"));
                if (docSnap.exists()) {
                    const d = docSnap.data();
                    document.getElementById('contact-phone').innerText = d.phone;
                    document.getElementById('contact-phone').href = "tel:" + d.phone;
                    
                    document.getElementById('contact-email').innerText = d.email;
                    document.getElementById('contact-email').href = "mailto:" + d.email;
                    
                    document.getElementById('contact-addr').innerHTML = d.addr1 + "<br>" + d.addr2;
                    
                    document.getElementById('contact-fb').innerText = "facebook.com/postdhaka"; // Simplification
                    document.getElementById('contact-fb').href = d.fb;
                }
            } catch(e) {}
        }

        window.onload = () => {
            loadVideos();
            loadServices();
            loadAbout();
            loadContact();

            const v = document.getElementById('introVideo');
            if(v) v.onended = () => enterSite();
        };
    </script>

    <!-- GENERAL JS -->
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        function enterSite() {
            const o = document.getElementById('intro-overlay');
            if(o) { o.classList.add('hidden'); setTimeout(()=>document.getElementById('introVideo').pause(),1000); }
        }
        function showSection(id) {
            document.querySelectorAll('section').forEach(s=>s.classList.remove('active-section'));
            document.getElementById(id).classList.add('active-section');
            document.querySelectorAll('.menu a').forEach(a=>a.classList.remove('active'));
            if(event) event.target.classList.add('active');
        }
        
        const modal = document.getElementById('video-modal');
        let player;
        function onYouTubeIframeAPIReady(){}
        window.openModal = function(id) {
            modal.classList.add('active');
            if(player) player.destroy();
            player = new YT.Player('youtube-player-container', {
                height: '100%', width: '100%', videoId: id,
                playerVars: { 'autoplay': 1, 'rel': 0, 'modestbranding': 1 },
                events: { 'onReady': (e)=>e.target.playVideo() }
            });
        }
        window.closeModal = function() {
            modal.classList.remove('active');
            if(player) { player.stopVideo(); player.destroy(); player=null; }
        }
    </script>
</body>
</html>
