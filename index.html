<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Dhaka | Visual Experience</title>
    <link rel="icon" href="Assets/Post Dhaka icon.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* CORE CSS */
        :root { --primary-blue: #0872B9; --primary-pink: #EA1C5C; --bg-dark: #121A2D; --white: #FFFFFF; --gray: #B0B0B0; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Helvetica Neue', Arial, sans-serif; }
        body { background-color: var(--bg-dark); color: var(--white); overflow-x: hidden; }
        
        /* GRID - AUTO DENSE (THIS IS THE MAGIC FOR NO BLANK SPACES) */
        .video-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            grid-auto-rows: 200px; 
            gap: 15px; 
            max-width: 1800px; margin: 0 auto; 
            grid-auto-flow: dense; /* VITAL: Fills holes automatically */
        }
        
        .video-item { position: relative; background: #000; cursor: pointer; overflow: hidden; border-radius: 4px; transition: 0.3s; }
        .video-item:hover { transform: scale(1.02); z-index: 10; border: 3px solid #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.6); }

        /* SIZES */
        .small { grid-column: span 1; grid-row: span 1; } 
        .wide { grid-column: span 2; grid-row: span 1; } 
        .tall { grid-column: span 1; grid-row: span 2; } 
        .large { grid-column: span 2; grid-row: span 2; } 
        
        .iframe-wrapper { width: 100%; height: 100%; pointer-events: none; position: relative; overflow: hidden; }
        .thumb-img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; transition: opacity 0.3s; }
        .iframe-wrapper iframe { position: absolute; top: 50%; left: 50%; width: 300%; height: 300%; transform: translate(-50%, -50%); opacity: 0; transition: opacity 0.5s; }
        .video-item:hover .iframe-wrapper iframe { opacity: 1; }
        .video-item:hover .thumb-img { opacity: 0; }

        /* Other Site CSS (Nav, Services, etc - Kept Condensed) */
        #intro-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: var(--bg-dark); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 0.8s; }
        #intro-overlay video { width: 100%; height: 100%; object-fit: cover; }
        #intro-overlay.hidden { transform: translateY(-100%); }
        .skip-btn { position: absolute; bottom: 30px; padding: 10px 25px; background: rgba(255,255,255,0.1); border: 1px solid var(--primary-pink); color: var(--white); cursor: pointer; border-radius: 30px; }
        
        nav { position: fixed; top: 0; width: 100%; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; background: rgba(18, 26, 45, 0.95); backdrop-filter: blur(10px); z-index: 1000; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .logo img { height: 40px; }
        .menu a { color: var(--white); text-decoration: none; margin-left: 35px; font-weight: bold; font-size: 14px; }
        .menu a.active { color: var(--primary-pink); }
        
        section { display: none; padding: 100px 20px; min-height: 100vh; animation: fadeIn 0.5s; }
        section.active-section { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .service-container { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; }
        .service-card { background: rgba(255,255,255,0.05); border-radius: 10px; width: 350px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        .service-media { height: 200px; background: #000; overflow: hidden; }
        .service-media video, .service-media img { width: 100%; height: 100%; object-fit: cover; }
        .service-info { padding: 20px; text-align: center; }
        
        .contact-wrapper { display: flex; flex-wrap: wrap; justify-content: center; gap: 50px; }
        .contact-item { display: flex; align-items: center; margin-bottom: 20px; }
        .contact-icon { font-size: 24px; color: var(--primary-pink); margin-right: 15px; }
        .map-container { width: 100%; height: 400px; border-radius: 10px; overflow: hidden; border: 2px solid #333; }
        
        #video-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.95); z-index: 5000; display: none; justify-content: center; align-items: center; }
        #video-modal.active { display: flex; }
        .modal-content { width: 90%; max-width: 1200px; aspect-ratio: 16/9; background: #000; position: relative; }
        .close-btn { position: absolute; top: -40px; right: 0; color: white; font-size: 40px; cursor: pointer; }

        @media (max-width: 768px) { .video-grid { grid-template-columns: 1fr 1fr; } .wide, .large { grid-column: span 2; } }
    </style>
</head>
<body>

    <div id="intro-overlay">
        <video id="introVideo" autoplay muted playsinline><source src="Assets/Logo Intro.webm" type="video/webm"><source src="Assets/Logo Intro.mp4" type="video/mp4"></video>
        <button class="skip-btn" onclick="enterSite()">SKIP INTRO</button>
    </div>

    <nav>
        <div class="logo" onclick="showSection('home')"><img src="Assets/Post Dhaka Logo.png"></div>
        <div class="menu">
            <a href="#" onclick="showSection('home')" class="active">HOME</a>
            <a href="#" onclick="showSection('service')">SERVICE</a>
            <a href="#" onclick="showSection('about')">ABOUT</a>
            <a href="#" onclick="showSection('contact')">CONTACT</a>
        </div>
    </nav>

    <section id="home" class="active-section">
        <div class="video-grid" id="gallery-container"></div>
    </section>

    <section id="service">
        <h1 style="text-align:center; color:white;">OUR SERVICES</h1>
        <div class="service-container" id="dynamic-services"></div>
    </section>

    <section id="about">
        <div style="max-width:900px; margin:0 auto; text-align:center;">
            <h1 id="about-title" style="color:var(--primary-pink); font-size:48px;">WHO WE ARE</h1>
            <p id="about-desc" style="color:#ddd; line-height:1.8; white-space: pre-wrap;"></p>
        </div>
    </section>

    <section id="contact">
        <h1 style="text-align:center; color:white;">GET IN TOUCH</h1>
        <div class="contact-wrapper">
            <div id="contact-details" style="color:#ccc;"></div>
            <div class="map-container"><iframe src="https://maps.google.com/maps?q=23.7732081,90.4074902&hl=en&z=17&output=embed" width="100%" height="100%" allowfullscreen></iframe></div>
        </div>
    </section>

    <div id="video-modal"><div class="modal-content"><span class="close-btn" onclick="closeModal()">&times;</span><div id="youtube-player-container" style="width:100%; height:100%;"></div></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, doc, getDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBzQ81jG6k6ieD5HShAgubU3fX0eV6x7j8",
            authDomain: "postdhaka-links.firebaseapp.com",
            projectId: "postdhaka-links",
            storageBucket: "postdhaka-links.firebasestorage.app",
            messagingSenderId: "21578530372",
            appId: "1:21578530372:web:ce243a7141d402fb924611",
            measurementId: "G-EZVZ5DSX46"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- SMART GRID LOGIC ---
        // এই প্যাটার্নটি ব্যবহার করা হবে গ্যাপ পূরণ করার জন্য
        // Large (2x2), Small(1), Small(1), Wide(2), Small(1), Small(1) = 8 blocks
        const sizePattern = ['large', 'small', 'small', 'wide', 'small', 'small', 'wide', 'sq'];

        async function loadVideos() {
            const container = document.getElementById('gallery-container');
            const q = query(collection(db, "videos"), orderBy("orderIndex", "asc"));
            const snap = await getDocs(q);
            
            let html = '';
            
            snap.docs.forEach((doc, index) => {
                const d = doc.data();
                
                // AUTO SIZE CALCULATION
                let sizeClass = 'small';
                
                // 1. Check if it's a Shorts video (usually tall)
                // (Note: YouTube API needed for perfect detection, but we can assume manually or randomize)
                
                // 2. Apply Pattern Loop
                sizeClass = sizePattern[index % sizePattern.length];

                const url = `https://www.youtube.com/embed/${d.id}?enablejsapi=1&autoplay=1&mute=1&controls=0&showinfo=0&rel=0&loop=1&playlist=${d.id}&modestbranding=1`;
                
                html += `
                <div class="video-item ${sizeClass}" onclick="openModal('${d.id}')">
                    <div class="hover-overlay"></div>
                    <div class="iframe-wrapper">
                        <img class="thumb-img" src="https://img.youtube.com/vi/${d.id}/maxresdefault.jpg">
                        <iframe src="${url}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                    </div>
                </div>`;
            });
            container.innerHTML = html || "<p style='color:white;text-align:center'>No videos.</p>";
        }

        async function loadServices() {
            const snap = await getDocs(query(collection(db, "content_services"), orderBy("order", "asc")));
            let h = '';
            snap.forEach(d=>{
                const s = d.data();
                let m = s.type=='video' ? `<video autoplay muted loop playsinline poster="${s.src}"><source src="${s.src}"></video>` : `<img src="${s.src}">`;
                h+=`<div class="service-card"><div class="service-media">${m}</div><div class="service-info"><h2>${s.title}</h2><p>${s.description}</p></div></div>`;
            });
            if(h) document.getElementById('dynamic-services').innerHTML=h;
        }

        async function loadText() {
            const a = await getDoc(doc(db, "site_content", "about"));
            if(a.exists()) {
                document.getElementById('about-title').innerText = a.data().title;
                document.getElementById('about-desc').innerText = a.data().description;
            }
            const c = await getDoc(doc(db, "site_content", "contact"));
            if(c.exists()) {
                const d = c.data();
                document.getElementById('contact-details').innerHTML = `
                <div class="contact-item"><i class="fas fa-phone-alt contact-icon"></i> ${d.phone}</div>
                <div class="contact-item"><i class="fas fa-envelope contact-icon"></i> ${d.email}</div>
                <div class="contact-item"><i class="fas fa-map-marker-alt contact-icon"></i> ${d.addr1}<br>${d.addr2}</div>
                <div class="contact-item"><i class="fab fa-facebook-f contact-icon"></i> <a href="${d.fb}" target="_blank" style="color:gray">facebook</a></div>`;
            }
        }

        window.onload = () => { loadVideos(); loadServices(); loadText(); document.getElementById('introVideo').onended=enterSite; }
    </script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        function enterSite(){document.getElementById('intro-overlay').classList.add('hidden'); setTimeout(()=>document.getElementById('introVideo').pause(),1000);}
        function showSection(id){document.querySelectorAll('section').forEach(s=>s.classList.remove('active-section'));document.getElementById(id).classList.add('active-section');}
        
        const modal = document.getElementById('video-modal'); let player;
        window.openModal = function(id){modal.classList.add('active'); if(player)player.destroy(); player=new YT.Player('youtube-player-container',{height:'100%',width:'100%',videoId:id,playerVars:{'autoplay':1,'rel':0},events:{'onReady':e=>e.target.playVideo()}});}
        window.closeModal = function(){modal.classList.remove('active'); if(player){player.stopVideo();player.destroy();player=null;}}
    </script>
</body>
</html>
